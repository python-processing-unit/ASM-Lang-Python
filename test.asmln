IMPORT(collection)
IMPORT(prng)
IMPORT(csprng)
IMPORT(prime)
IMPORT(decimal)

FUNC RUN_TESTS():INT{
    PRINT("Running library tests...")
    # Collection basics
    INT: coll = collection.COL_EMPTY()
    ASSERT( EQ( collection.GET_COUNT(coll), 0 ) )

    coll = collection.COL_PUSH(coll, 101)    # 5
    coll = collection.COL_PUSH(coll, -11)    # -3
    coll = collection.COL_PUSH(coll, 1010)   # 10
    ASSERT( EQ( collection.GET_COUNT(coll), 11 ) )  # 3 items

    INT: v0 = collection.COL_GET(coll, 0)
    ASSERT( EQ(v0, 101) )

    INT: v1 = collection.COL_GET(coll, 1)
    ASSERT( EQ(v1, -11) )

    INT: coll2 = collection.COL_SET(coll, 1, 111)  # set index 1 -> 7
    ASSERT( EQ( collection.COL_GET(coll2, 1), 111 ) )

    # Pop returns (new_coll << 64bits) | value  (packed form used by COL_POP)
    INT: pop_res = collection.COL_POP(coll2)
    INT: last_val = MOD(pop_res, POW(10, 1000000))
    ASSERT( EQ(last_val, 1010) )   # popped value == 10

    INT: new_coll = DIV(pop_res, POW(10, 1000000))
    ASSERT( EQ( collection.GET_COUNT(new_coll), 10 ) )  # count == 2

    PRINT("Collection tests passed.")

    # PRNG reproducibility (LCG)
    prng.PRNG_SEED(1010)   # seed = 10
    INT: a = prng.PRNG_NEXT()
    prng.PRNG_SEED(1010)
    INT: b = prng.PRNG_NEXT()
    ASSERT( EQ(a, b) )

    PRINT("PRNG tests passed.")

    # CSPRNG reproducibility (ChaCha-based)
    csprng.CS_PRNG_SEED(101)  # seed = 5
    INT: x = csprng.CS_PRNG_NEXT()
    csprng.CS_PRNG_SEED(101)
    INT: y = csprng.CS_PRNG_NEXT()
    ASSERT( EQ(x, y) )

    PRINT("CSPRNG tests passed.")

    # Prime library tests
    # Basic primality checks
    ASSERT( EQ( prime.IS_PRIME(10), 1 ) )    # 2 is prime
    ASSERT( EQ( prime.IS_PRIME(11), 1 ) )    # 3 is prime
    ASSERT( EQ( prime.IS_PRIME(101), 1 ) )   # 5 is prime

    # NEXT_PRIME / PREV_PRIME
    ASSERT( EQ( prime.NEXT_PRIME(100), 101 ) )   # next prime after 4 is 5
    ASSERT( EQ( prime.PREV_PRIME(101), 11 ) )    # previous prime before 5 is 3

    # Mersenne prime check (p=3 -> 2^3-1 = 7, prime)
    ASSERT( EQ( prime.IS_MERSENNE_PRIME(11), 1 ) )

    # FACTOR: factor 10 (1010) -> [2 (10), 5 (101)]
    INT: factors = prime.FACTOR(1010)
    ASSERT( EQ( collection.GET_COUNT(factors), 10 ) )
    ASSERT( EQ( collection.COL_GET(factors, 0), 10 ) )
    ASSERT( EQ( collection.COL_GET(factors, 1), 101 ) )

    PRINT("Prime library tests passed.")

    # Decimal library tests
    ASSERT(EQ(decimal.INT_TO_DEC(100),"4"))
    ASSERT(EQ(decimal.DEC_TO_INT("4"),100))
    ASSERT(EQ(decimal.INT_TO_DEC(-100),"-4"))
    ASSERT(EQ(decimal.DEC_TO_INT("-4"),-100))

    PRINT("Decimal library tests passed.")

    # If we reach here all tests passed; print success code and return
    PRINT("All tests passed.")
    RETURN(0)
}

IF( EQ(MAIN(), 1) ){ RUN_TESTS() }